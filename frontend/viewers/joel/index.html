<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
  <title>Experiment 2</title>
  <style>
    body {
      background-color: #222;
    }

    .decorate {
      border: 1px solid #444;
      background-color: #555;
      border-radius: 3px;
      -webkit-border-radius: 3px;
      -moz-border-radius: 3px;
    }

    #screen {
      display: block;
      margin-top: 50px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <canvas id="screen" class="decorate" width="400" height="320">
    Your browser doesn't seem to support canvas...
  </canvas>
<script type="text/javascript">



  var fps = 10;


  var buffer = [];


  
  

	window.viewer = {
		receiveEvent:function(evtName,data) {
	
			//if (evtName=="coreChange") {
	
			if (evtName=="coreExec") {
		
				buffer.push(data);

				return true;
		
			} else if (evtName=="gameStart") {
				
				var canvas = document.getElementById('screen');
				
				if (canvas.getContext) {
				    var ctx = canvas.getContext('2d');
				    ctx.fillStyle = "#111";
				    ctx.fillRect(0,0,400,320);

				    // good colors:
				    // #ff9800 = rgb(255, 152, 0)
				    // #7e8aa2 = rgb(126, 138, 162)
				    // #b1d631 = rgb(177, 214, 49)
				    var q = new Array();

				    var frame = function() {
					
					  for (var i=0;i<buffer.length;i++) {
						if (buffer[i].warrior=="1") {
							q.push([buffer[i].position % 100,Math.floor(buffer[i].position / 100),"116,149,214"]);
						} else {
							q.push([buffer[i].position % 100,Math.floor(buffer[i].position / 100),"177,214,49"]);
						}
					  }
					  buffer = [];
					
				      for (var i = q.length-1; i >= 0; i-=1) {
				        var j = q.length-i-2;
				        ctx.fillStyle = "#111";
				        ctx.fillRect(q[i][0]*4,q[i][1]*4,4,4);
				        ctx.fillStyle = "rgba("+q[i][2]+"," + 1 + ")"; //Math.max(0.5,1-j*0.06)
				        ctx.fillRect(q[i][0]*4,q[i][1]*4,4,4);
				      }
				      q = [];
				      /*if (q.length >= 6) {
				        q = q.slice(q,q.length-6);
				      }*/
				
					  setTimeout(frame,fps/1000);
				    };
				
					frame();
				  }
				
				
				
				

				return true;
			}
	
		}
	};





</script>
</body>
</html>